<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pageModels="clr-namespace:WebshopMobileApp.PageModels"
             xmlns:models="clr-namespace:WebshopMobileApp.Models"
             xmlns:controls="clr-namespace:WebshopMobileApp.Pages.Controls"
             xmlns:pullToRefresh="clr-namespace:Syncfusion.Maui.Toolkit.PullToRefresh;assembly=Syncfusion.Maui.Toolkit"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="WebshopMobileApp.Pages.MainPage"
             x:DataType="pageModels:MainPageModel"
             Title="">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior
            EventName="Appearing"
            Command="{Binding LoadItemsCommand}" />
    </ContentPage.Behaviors>

    <pullToRefresh:SfPullToRefresh>
        <pullToRefresh:SfPullToRefresh.PullableContent>

            <CollectionView ItemsSource="{Binding Categories}"
                            Margin="10">

                <!-- HEADER -->
                <CollectionView.Header>
                    <VerticalStackLayout Spacing="0">

                        <!-- TOP LABEL -->
                        <Label Text="Fetching data from the server  for the first time takes a little while. Please wait ..."
                            Padding="10"
                            Margin="0,0,0,0"
                            BackgroundColor="#0698d5"
                            FontSize="16"
                             FontAttributes="Italic"
                            TextColor="White"
                               HeightRequest="100"
                               IsVisible="{Binding PleaseWaitMessage}"
                            Style="{StaticResource Title2}"
                            HorizontalTextAlignment="Center" />
                           <ActivityIndicator Margin="0,0,0,10"
                            IsVisible="{Binding PleaseWaitSpinner}"
                            IsRunning="True"
                            HeightRequest="300"
                            Color="White" BackgroundColor="#0698d5" />

                        <!-- TOP LABEL -->
                        <Label Text="{Binding DeliveryDate}"
                           Padding="10"
                           Margin="0,0,0,10"
                           BackgroundColor="#0698d5"
                           FontSize="16"
                           TextColor="White"
                           Style="{StaticResource Title2}"
                           HorizontalTextAlignment="Center" />

                        <!-- BLUE SECTION -->
                        <VerticalStackLayout Spacing="0"
                             Padding="10"
                             BackgroundColor="#0698d5">

                            <Label Text="Weekly Promotions"
                               Padding="1"
                               FontSize="18"
                               TextColor="White"
                               Style="{StaticResource Title2}"
                               HorizontalTextAlignment="Center" />

                                <ActivityIndicator
                                IsVisible="{Binding ISVisibleSpinner}"
                                IsRunning="True"
                                Color="White" />

                            <ScrollView Orientation="Horizontal"
                        Margin="-30,0">
                                <HorizontalStackLayout
                                    Spacing="15"
                                    Padding="30,0"
                                    BindableLayout.ItemsSource="{Binding Slots}">

                                    <BindableLayout.ItemTemplate>
                                        <DataTemplate x:DataType="models:TblPromoPicturesSet">
                                            <VerticalStackLayout Spacing="6">
                                                <controls:SlotCardView WidthRequest="300" />
                                            </VerticalStackLayout>
                                        </DataTemplate>
                                    </BindableLayout.ItemTemplate>

                                </HorizontalStackLayout>
                            </ScrollView>

                        </VerticalStackLayout>

                    </VerticalStackLayout>
                </CollectionView.Header>


                <!-- CATEGORIES GRID -->
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical"
                                     Span="3"
                                     HorizontalItemSpacing="10"
                                     VerticalItemSpacing="10" />
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Category">
                        <Border Stroke="#000"
                                StrokeThickness="1"
                                StrokeShape="RoundRectangle 0"
                                BackgroundColor="White"
                                Padding="0">

                            <!--<Image Source="avatar.png"
                                   Aspect="AspectFit"
                                   HeightRequest="80"
                                   WidthRequest="100"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />-->
                            
                            <Image Source="{Binding FileUrl}"
                                    Aspect="AspectFit"
                                    HeightRequest="80"
                                    WidthRequest="100"
                                    HorizontalOptions="Center"
                                    VerticalOptions="Center">
                            <Image.GestureRecognizers>
                                <TapGestureRecognizer 
                                 Command="{Binding x:DataType='pageModels:MainPageModel', Source={RelativeSource AncestorType={x:Type pageModels:MainPageModel}}, Path=GoToCatalogCommand}"
                                 CommandParameter="{Binding CategoryId}" />
                            </Image.GestureRecognizers>
                            </Image>

                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

            </CollectionView>

        </pullToRefresh:SfPullToRefresh.PullableContent>
    </pullToRefresh:SfPullToRefresh>

</ContentPage>
